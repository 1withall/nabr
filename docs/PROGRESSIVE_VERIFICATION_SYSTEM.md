# Progressive Trust Verification System

## Core Mission: Universal Access to Verified Identity

> "Some people may not have access to reliable internet or cellular service at home. Some may not have a home address or state-issued ID. This app will give them an opportunity to prove that they are who they say they are, even if they don't have any of those things."

**The identity verification process is ABSOLUTELY CRITICAL to the success of the app.**

## Revolutionary Design Philosophy

### Traditional Systems (WRONG)
- **Hard requirements**: Must have email AND phone AND ID
- **Exclusionary**: People without documentation cannot verify
- **One-size-fits-all**: Same requirements for everyone
- **Rigid**: No flexibility for individual circumstances

### Our System (CORRECT)
- **Progressive trust accumulation**: Multiple weak signals = strong verification
- **Inclusive by design**: People without ANY traditional documentation can verify
- **Unique paths per user type**: Individual, Business, Organization each different
- **Flexible and adaptive**: Many paths to same verification level

## Trust Scoring Model

### How It Works

Instead of requiring specific methods, each verification method **contributes points** toward your trust score. Your verification level is determined by your **total points**, not by which specific methods you've completed.

```
UNVERIFIED: 0 points     - No verification
MINIMAL:    100+ points  - Basic platform access
STANDARD:   250+ points  - Enhanced features
ENHANCED:   400+ points  - Trusted community member
COMPLETE:   600+ points  - Fully verified
```

### Example: Individual Without Documentation

**Person**: No government ID, no home address, no internet at home, no smartphone

**How they can still verify:**
1. Two trusted community members confirm their identity in person: **+150 points** → **MINIMAL LEVEL** ✅
2. They can stop here and access all basic platform features!

**To reach STANDARD (250+):**
- Get one more community attestation: +40 points
- Build platform history over 6 months: +30 points
- Get a personal reference: +50 points
- **Total: 270 points** → **STANDARD LEVEL** ✅

**No email, phone, or ID required at any point.**

## User Type-Specific Paths

### INDIVIDUALS: Community-Based Verification

**Philosophy**: Your community knows you, even if the government doesn't have you in their systems.

**Baseline Method**:
- **Two-party in-person verification** (150 points)
  - Two Authorized Verifiers confirm your identity face-to-face
  - Verifiers can be: notaries, community leaders, verified business owners, etc.
  - **Sufficient for MINIMAL level access**

**Alternative Paths to MINIMAL**:
1. Single verifier (75) + community attestation (40) + email (30) = 145 points
2. Government ID (100) + platform history (30) = 130 points
3. Biometric (80) + personal reference (50) = 130 points

**Email/Phone**: OPTIONAL methods that ADD 30 points each, but never required

### BUSINESSES: Documentary Evidence

**Philosophy**: Prove business legitimacy through official records, not arbitrary requirements.

**Baseline Methods** (any ONE):
- Business license: 120 points
- Tax ID (EIN): 120 points
- Business address (80) + owner verification (100) = 180 points

**Path to MINIMAL**:
- Business license OR tax ID: ~120 points
- Add email for 30 more: 150 points → **MINIMAL LEVEL** ✅

**Email/Phone**: OPTIONAL contact methods, not requirements

### ORGANIZATIONS: Mission & Governance

**Philosophy**: Prove organizational legitimacy and community alignment.

**Baseline Methods** (any ONE):
- 501(c)(3) status: 120 points
- Tax ID: 120 points
- Board verification: 100 points

**Path to MINIMAL**:
- 501(c)(3) documentation (120) + email (30) = 150 points → **MINIMAL LEVEL** ✅

**Email/Phone**: OPTIONAL contact methods, not requirements

## Method Scoring Reference

### Universal Methods (OPTIONAL)
| Method | Points | Notes |
|--------|--------|-------|
| Email | +30 | Renew annually |
| Phone | +30 | Renew annually |

### Individual Methods
| Method | Points | Multiplier | Notes |
|--------|--------|------------|-------|
| Two-party in-person | +150 | 1x | **BASELINE** - Works without ANY other documentation |
| Single-party in-person | +75 | 1x | Half of two-party |
| Government ID | +100 | 1x | Driver's license, passport, etc. |
| Biometric | +80 | 1x | Facial recognition |
| Personal reference | +50 | 3x | Up to 3 references (150 total) |
| Community attestation | +40 | 2x | Up to 2 attestations |
| Platform history | +30 | 1x | 6+ months good standing |
| Transaction history | +40 | 1x | Successful transactions |

### Business Methods
| Method | Points | Notes |
|--------|--------|-------|
| Business license | +120 | **BASELINE** - Sufficient alone |
| Tax ID (EIN) | +120 | **BASELINE** - Sufficient alone |
| Business address | +80 | Physical location verification |
| Owner verification | +100 | Owner identity confirmed |
| Business insurance | +60 | Liability insurance |
| Professional license | +80 | For contractors, etc. |
| Business references | +50 (3x) | Up to 3 references |
| Community endorsement | +60 (2x) | Up to 2 endorsements |

### Organization Methods
| Method | Points | Notes |
|--------|--------|-------|
| 501(c)(3) status | +120 | **BASELINE** - Sufficient with one more method |
| Tax ID (EIN) | +120 | **BASELINE** |
| Organization bylaws | +80 | Governing documents |
| Board verification | +100 | Board of directors verified |
| Mission alignment | +80 | Community review |
| Org references | +50 (3x) | Up to 3 references |
| Community endorsement | +60 (2x) | Up to 2 endorsements |

### Enhanced Methods (All Types)
| Method | Points | Notes |
|--------|--------|-------|
| Notary verification | +90 | Notarized documents |

## Example Verification Journeys

### Journey 1: Homeless Individual
**Background**: No permanent address, no government ID, no smartphone

**Step 1**: Attend community verification event
- Two community leaders confirm identity: +150 points
- **Result**: MINIMAL level ✅ - Can access platform!

**Step 2** (Optional - over time):
- Community member vouches for them: +40 points
- Build platform history (6 months): +30 points
- Get personal reference: +50 points
- **Total**: 270 points → **STANDARD level** ✅

**Step 3** (Optional - if they later get ID):
- Obtain government ID: +100 points
- Get notary verification: +90 points
- **Total**: 460 points → **ENHANCED level** ✅

### Journey 2: Small Business Owner
**Background**: New business, has email but no phone yet

**Step 1**: Register business
- Business license uploaded: +120 points
- Email verified: +30 points
- **Result**: 150 points → **MINIMAL level** ✅

**Step 2**: Establish presence
- Verify business address: +80 points
- Owner identity verified (in-person): +100 points
- **Total**: 330 points → **STANDARD level** ✅

### Journey 3: Community Organization
**Background**: Small nonprofit, limited documentation

**Step 1**: Provide basic docs
- 501(c)(3) documentation: +120 points
- Email verification: +30 points
- **Result**: 150 points → **MINIMAL level** ✅

**Step 2**: Strengthen trust
- Submit bylaws: +80 points
- Board member verification: +100 points
- **Total**: 330 points → **STANDARD level** ✅

### Journey 4: Person WITH Traditional Documentation
**Background**: Has everything (email, phone, ID, address)

**Step 1**: Provide documentation
- Government ID: +100 points
- Email: +30 points
- Phone: +30 points
- **Result**: 160 points → **MINIMAL level** ✅

**Step 2**: Add verification
- Two-party in-person: +150 points
- **Total**: 310 points → **STANDARD level** ✅

**Key Point**: Person WITH documentation doesn't get inherently higher trust than person WITHOUT documentation. Both can reach the same levels through different paths.

## Temporal Workflow Architecture

### Advanced Patterns Used

Our verification system leverages Temporal's most advanced features for maximum modularity and reliability:

#### 1. Child Workflows
Each verification method runs as a **child workflow**, allowing:
- Independent lifecycle management per method
- Parallel verification of multiple methods
- Isolated failure handling
- Clean encapsulation of method-specific logic

```python
# Individual verification spawns child workflows
email_verification = await workflow.execute_child_workflow(
    EmailVerificationWorkflow,
    user_id=user_id,
    email=email,
    id=f"email-verification-{user_id}"
)
```

#### 2. Signals
Real-time updates via **signals**:
- Verifiers confirm identity via signal
- Community attestations submitted via signal
- Trust score updates propagated via signal
- Status changes notified via signal

```python
@workflow.signal
async def verifier_confirms_identity(self, verifier_id: str, notes: str):
    """Signal received when authorized verifier confirms identity."""
    self.confirmations[verifier_id] = notes
    await self._recalculate_trust_score()
```

#### 3. Queries
Check verification status via **queries**:
- Get current trust score
- Check verification level
- List completed methods
- Get next level requirements

```python
@workflow.query
def get_current_trust_score(self) -> int:
    """Query current trust score without blocking."""
    return self.trust_score
```

#### 4. Sagas
Complex multi-step verifications use **saga pattern**:
- Coordinate multiple verification steps
- Automatic compensation on failure
- Maintain consistency across distributed operations
- Handle revocations gracefully

```python
# Saga for two-party verification
async def two_party_verification_saga(self):
    try:
        # Step 1: Generate QR codes
        qr_codes = await self.generate_qr_codes()
        
        # Step 2: Wait for verifier confirmations
        await self.wait_for_confirmations(qr_codes)
        
        # Step 3: Award trust points
        await self.award_trust_points(150)
    except Exception:
        # Compensate: Revoke points, notify verifiers
        await self.compensate_two_party_verification()
        raise
```

#### 5. Continue-As-New
Long-running verification workflows use **continue-as-new**:
- Handle workflows that span months/years
- Manage verification renewals
- Prevent event history growth
- Support ongoing trust accumulation

#### 6. Versioning
Support evolving verification logic via **workflow versioning**:
- Safely deploy new verification methods
- Update scoring algorithms without breaking existing workflows
- Maintain backward compatibility with old verifications

## API Usage

### Calculate Trust Score

```python
from nabr.models.verification_types import (
    calculate_trust_score,
    calculate_verification_level,
    UserType,
    VerificationMethod
)

# User has completed these methods
completed = {
    VerificationMethod.IN_PERSON_TWO_PARTY: 1,  # 1x two-party verification
    VerificationMethod.EMAIL: 1,                 # 1x email
    VerificationMethod.PERSONAL_REFERENCE: 3,    # 3x references (max multiplier)
}

# Calculate score
score = calculate_trust_score(completed, UserType.INDIVIDUAL)
# Result: 150 + 30 + 150 = 330 points

# Determine level
level = calculate_verification_level(score)
# Result: VerificationLevel.STANDARD (250+ points)
```

### Get Next Level Requirements

```python
from nabr.models.verification_types import get_next_level_requirements

# Current state
current_score = 330
user_type = UserType.INDIVIDUAL
completed = {VerificationMethod.IN_PERSON_TWO_PARTY, VerificationMethod.EMAIL}

# What's needed for next level?
next_level, points_needed, suggested_paths = get_next_level_requirements(
    current_score,
    user_type,
    completed
)

# Result:
# next_level = VerificationLevel.ENHANCED
# points_needed = 70 (400 - 330)
# suggested_paths = [list of method combinations that provide 70+ points]
```

### Check Method Applicability

```python
from nabr.models.verification_types import get_applicable_methods

# Get all methods for individual users
individual_methods = get_applicable_methods(UserType.INDIVIDUAL)

# Get all methods for business users
business_methods = get_applicable_methods(UserType.BUSINESS)
```

## Migration Strategy

### Phase 1: Deploy New System (Backward Compatible)
- New trust scoring logic runs alongside old system
- Old API functions preserved (marked DEPRECATED)
- Existing verifications still valid

### Phase 2: Migrate Existing Users
- Calculate trust scores from existing verification methods
- Award points for previously completed verifications
- User levels may INCREASE due to more generous scoring

### Phase 3: Deprecate Old System
- Remove hard requirements from old workflows
- Transition to pure trust scoring
- Update UI to show point values

### Phase 4: Expand Methods
- Add new verification methods (e.g., social graph analysis)
- Adjust point values based on data
- Community input on new methods

## Security Considerations

### Sybil Resistance
- Nullifier hashes prevent double-verification (from World ID research)
- In-person verification requires physical presence
- Verifiers must themselves be highly verified (STANDARD+ level)

### Fraud Prevention
- Methods requiring human review flagged for manual verification
- Point decay forces periodic renewal of certain verifications
- Anomaly detection for rapid trust accumulation
- Community can flag suspicious verifications

### Privacy Preservation
- Zero-knowledge proofs for sensitive verification (future)
- Selective disclosure of verification details
- Minimal data collection per method
- User controls what information is shared

## Best Practices from Research

### From World ID (Proof of Personhood)
- **Uniqueness guarantees**: Each person can verify only once
- **Privacy-first design**: Verification doesn't reveal unnecessary information
- **Sybil resistance**: Nullifier hashes prevent duplicate verifications

### From Persona API (Identity Verification)
- **Risk-based verification**: Higher-risk actions require higher verification levels
- **Multi-method verification**: Combine multiple weak signals for strong verification
- **Adaptive verification**: Requirements adapt to user behavior and risk profile

### From Self/Privado ID (Zero-Knowledge)
- **Selective disclosure**: Prove attributes without revealing underlying data
- **Verifiable credentials**: Cryptographic proofs of verification
- **Self-sovereign identity**: User controls their verification data

## Future Enhancements

### Phase 2D: Advanced Verification Methods
- **Biometric verification**: Facial recognition, fingerprint
- **Social graph analysis**: Trust based on verified connections
- **Behavioral analysis**: Trust accumulation through platform behavior
- **Zero-knowledge proofs**: Prove attributes without revealing data

### Phase 2E: Community-Driven Verification
- **Community vouching**: Verified members can vouch for new members
- **Reputation system**: Long-term behavior affects trust score
- **Dispute resolution**: Community can challenge questionable verifications
- **Verification marketplace**: Authorized verifiers earn reputation

### Phase 2F: Cross-Platform Verification
- **Verifiable credentials**: Export verification to other platforms
- **Decentralized identity**: Self-sovereign identity integration
- **Blockchain anchoring**: Immutable verification records
- **Interoperability**: Accept verifications from trusted external systems

## Conclusion

This progressive trust system achieves the core mission:

✅ **Universal Access**: People WITHOUT traditional documentation can verify  
✅ **Inclusive Design**: Multiple paths accommodate different circumstances  
✅ **Flexible & Adaptive**: System evolves with community needs  
✅ **Comprehensive & Robust**: Best practices from identity verification research  
✅ **Modular Architecture**: Temporal advanced features enable easy extension

**The identity verification process is ABSOLUTELY CRITICAL to the success of the app, and this design ensures that EVERYONE can establish a verified identity, regardless of their circumstances.**
